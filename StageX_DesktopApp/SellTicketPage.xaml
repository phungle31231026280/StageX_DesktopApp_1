<Page x:Class="StageX_DesktopApp.SellTicketPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      Title="Bán vé" Background="#FF1A1A1A" Foreground="White"
      Loaded="Page_Loaded">
    <!--
        Trang bán vé dành cho nhân viên.
        Bố cục mới: Bên trái có 3 phần dọc (1 trên, 2 giữa, 3 dưới); bên phải chỉ thanh toán.
    -->
    <Grid Margin="20">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="3*" />
            <ColumnDefinition Width="2*" />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <!-- Phần 1 -->
            <RowDefinition Height="*" />
            <!-- Phần 2 -->
            <RowDefinition Height="Auto" />
            <!-- Phần 3 -->
        </Grid.RowDefinitions>
        <!-- 1. Khu vực chọn vở diễn & suất chiếu (bên trái trên) -->
        <Border Grid.Column="0" Grid.Row="0" Background="#FF0C1220" CornerRadius="8" Padding="10" Margin="5">
            <StackPanel>
                <!-- Tiêu đề khu vực chọn vở diễn và suất chiếu -->
                <TextBlock Text="1. Vở diễn &amp; Suất chiếu" FontSize="16" FontWeight="SemiBold" Foreground="#FFFFC107" />

                <!-- Khu vực chọn chế độ bán vé: Mặc định hoặc Giờ cao điểm -->
                <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                    <!-- Mặc định: hiển thị cả vở diễn và suất diễn -->
                    <RadioButton x:Name="DefaultModeRadio" Content="Mặc định" GroupName="SellMode" IsChecked="True" Foreground="White" Margin="0,0,10,0" Checked="ModeRadio_Checked" />
                    <!-- Giờ cao điểm: ẩn vở diễn, chỉ còn suất diễn top 3 gần nhất -->
                    <RadioButton x:Name="PeakModeRadio" Content="Giờ cao điểm" GroupName="SellMode" Foreground="White" Checked="ModeRadio_Checked" />
                </StackPanel>

                <!-- Khu vực chọn vở diễn và suất chiếu -->
                <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                    <!-- Panel chọn vở diễn, có thể ẩn khi ở chế độ Giờ cao điểm -->
                    <StackPanel x:Name="ShowPanel" Orientation="Horizontal">
                        <TextBlock Text="Vở diễn:" VerticalAlignment="Center" Margin="0,0,5,0" />
                        <ComboBox x:Name="ShowComboBox" Width="220" DisplayMemberPath="title" SelectedValuePath="show_id" SelectionChanged="ShowComboBox_SelectionChanged" />
                    </StackPanel>
                    <!-- Panel chọn suất diễn ở chế độ Mặc định -->
                    <StackPanel x:Name="PerformancePanel" Orientation="Horizontal" Margin="15,0,0,0">
                        <TextBlock Text="Suất chiếu:" VerticalAlignment="Center" Margin="0,0,5,0" />
                        <ComboBox x:Name="PerformanceComboBox" Width="250" DisplayMemberPath="Display" SelectedValuePath="performance_id" SelectionChanged="PerformanceComboBox_SelectionChanged" />
                    </StackPanel>
                    <!-- Panel hiển thị Top 3 suất diễn (chế độ Giờ cao điểm) -->
                    <!-- Sử dụng UniformGrid với 3 cột để các nút co giãn đều theo kích thước cửa sổ -->
                    <UniformGrid x:Name="PeakPerformancePanel" Columns="3" Margin="15,0,0,0" Visibility="Collapsed" HorizontalAlignment="Stretch" VerticalAlignment="Center">
                        <Button x:Name="PeakButton1" Margin="0,0,5,0" Click="PeakPerformanceButton_Click" />
                        <Button x:Name="PeakButton2" Margin="0,0,5,0" Click="PeakPerformanceButton_Click" />
                        <Button x:Name="PeakButton3" Margin="0,0,0,0" Click="PeakPerformanceButton_Click" />
                    </UniformGrid>
                </StackPanel>
            </StackPanel>
        </Border>
        <!-- 2. Khu vực sơ đồ ghế (bên trái giữa) -->
        <!-- Chuyển sang sử dụng Grid thay cho StackPanel để phần sơ đồ ghế có thể giãn hết chiều cao còn lại. -->
        <Border Grid.Column="0" Grid.Row="1" Background="#FF0C1220" CornerRadius="8" Padding="10" Margin="5">
            <Grid>
                <Grid.RowDefinitions>
                    <!-- Dòng tiêu đề -->
                    <RowDefinition Height="Auto" />
                    <!-- Dòng chứa ScrollViewer, chiếm toàn bộ phần còn lại -->
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>
                <TextBlock Grid.Row="0" Text="2. Sơ đồ ghế" FontSize="16" FontWeight="SemiBold" Foreground="#FFFFC107" />
                <!-- ScrollViewer dùng để cuộn và phóng to/thu nhỏ sơ đồ ghế. Gắn Align = Stretch để không bị ẩn ghế khi zoom -->
                <StackPanel x:Name="SeatLegendPanel"
            Grid.Row="0"
            Margin="0,30,0,0"
            Orientation="Horizontal"
            VerticalAlignment="Top"
            Visibility="Collapsed" />
                <ScrollViewer Grid.Row="3" x:Name="SeatScrollViewer" Margin="0,10,0,0" HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto" PreviewMouseWheel="SeatScrollViewer_PreviewMouseWheel" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
                    <!-- Đặt căn lề của sơ đồ ghế về trái trên để tránh bị ẩn khi phóng -->
                    <Grid x:Name="SeatMapGrid" HorizontalAlignment="Left" VerticalAlignment="Top" />
                </ScrollViewer>
            </Grid>
        </Border>
        <!-- 3. Khu vực thông tin chi tiết (bên trái dưới, dưới sơ đồ ghế) -->
        <Border Grid.Column="0" Grid.Row="4" Background="#FF0C1220" CornerRadius="8" Padding="10" Margin="5">
            <StackPanel>
                <TextBlock Text="3. Thông tin chi tiết" FontSize="16" FontWeight="SemiBold" Foreground="#FFFFC107" />
                <TextBlock x:Name="SelectedShowText" FontSize="14" FontWeight="SemiBold" Margin="0,5,0,0" />
                <TextBlock x:Name="SelectedPerformanceText" FontSize="14" Margin="0,0,0,5" />
                <DataGrid x:Name="BillGrid" AutoGenerateColumns="False" CanUserAddRows="False" HeadersVisibility="Column" Height="120" Background="Transparent" RowBackground="Transparent" Foreground="White" BorderThickness="0"
      GridLinesVisibility="Horizontal" HorizontalGridLinesBrush="#333"
       RowHeaderWidth="0">

                    <DataGrid.Resources>
                        <Style TargetType="DataGridColumnHeader">
                            <Setter Property="Background" Value="Black"/>
                            <Setter Property="Foreground" Value="White"/>
                            <Setter Property="Padding" Value="10,8"/>
                            <Setter Property="FontSize" Value="14"/>
                            <Setter Property="FontWeight" Value="Bold"/>
                        </Style>
                    </DataGrid.Resources>
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Ghế" Binding="{Binding SeatLabel}" Width="*" />
                        <DataGridTextColumn Header="Đơn giá" Binding="{Binding Price, StringFormat='N0'}" Width="*" />
                    </DataGrid.Columns>
                </DataGrid>
                <TextBlock x:Name="TotalTextBlock" Text="Thành tiền: 0đ" FontSize="14" FontWeight="Bold" HorizontalAlignment="Right" Margin="0,5,0,5" />
            </StackPanel>
        </Border>
        <!-- 4. Khu vực thanh toán và nút lưu (bên phải, span toàn bộ chiều cao) -->
        <Border Grid.Column="1" Grid.Row="0" Grid.RowSpan="3" Background="#FF0C1220" CornerRadius="8" Padding="10" Margin="5">
            <StackPanel>
                <TextBlock Text="4. Thanh toán" FontSize="16" FontWeight="SemiBold" Foreground="#FFFFC107" />
                <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                    <Button x:Name="CashButton" Content="Tiền mặt" Padding="10,5" Margin="0,0,10,0" Click="PaymentButton_Click" Background="#FF0C1220" Foreground="#FFFFC107" BorderBrush="#FFFFC107" />
                    <Button x:Name="BankButton" Content="Chuyển khoản" Padding="10,5" Click="PaymentButton_Click" Background="#FF0C1220" Foreground="#FFFFC107" BorderBrush="#FFFFC107" />
                </StackPanel>
                <StackPanel x:Name="CashPanel" Orientation="Horizontal" Margin="0,5,0,0" Visibility="Visible">
                    <TextBlock Text="Khách đưa:" VerticalAlignment="Center" Margin="0,0,5,0" />
                    <TextBox x:Name="CustomerCashTextBox" Width="120" TextChanged="CustomerCashTextBox_TextChanged" />
                    <TextBlock Text="Tiền thừa:" VerticalAlignment="Center" Margin="10,0,5,0" />
                    <TextBlock x:Name="ChangeTextBlock" Text="0đ" VerticalAlignment="Center" />
                </StackPanel>
                <StackPanel x:Name="QrPanel" Margin="0,5,0,0" Visibility="Collapsed">
                    <TextBlock Text="Quét QR để chuyển khoản:" VerticalAlignment="Center" Margin="0,0,0,5" />
                    <!-- Ảnh QR co giãn theo kích thước panel và không vượt quá 300px -->
                    <Image x:Name="QrImage" MaxWidth="300" MaxHeight="300" Stretch="Uniform" HorizontalAlignment="Center" VerticalAlignment="Top" />
                </StackPanel>
                <Button x:Name="SaveButton" Content="Lưu" HorizontalAlignment="Right" Padding="10,5" Margin="0,10,0,0" Click="SaveButton_Click" />
            </StackPanel>
        </Border>
    </Grid>
</Page>